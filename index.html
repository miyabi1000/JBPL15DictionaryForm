<!doctype html>
<html lang="en">
<head>
<meta charset=utf-8">
<title>Dictionary Form Practice Lesson 15</title>
<style type="text/css">
.topClass {
	vertical-align: top;
        margin: auto;
}
.mStyle {
        /* border-radius: 5px;
    	border: 2px solid #2345a9;  */
	padding: 5px 5px;
	width: 600px;
        /*height: 50px; */
        /*align:left;*/
        vertical-align: top;
        /*display: table-cell;*/
        margin: auto; 
}

.button {
    background-color: #d5def8 ;
    /* border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;*/
    font-weight: bold;
    /* display: inline-block;*/
    font-size: 18px;
    font-family:UD Digi Kyokasho N-R;
}

.textfield {
    border-radius: 5px;
    border: 2px solid #2345a9;
    font-size: 14px;
    font-weight: bold;
    /* color: #2345a9; */
    padding: 3px 3px;
}
body {
    margin: 0;
    padding: 0;
}

.centered {
    margin: 0 auto;
    text-align: left;
    width: 800px;
}

</style>
<script type="text/javascript">

var totalTried = 0;
var totalCorrect = 0;
var yourScore = 0;
var isScoreUpdated = false;

<!-- SCORM API Related -->

function findAPI(win)
{
   // Check to see if the window (win) contains the API
   // if the window (win) does not contain the API and
   // the window (win) has a parent window and the parent window
   // is not the same as the window (win)
   if ( (win.API == null) &&
           (win.parent != null) &&
           (win.parent != win) )
   {
      
      win = win.parent;
   }
   return win.API;
}
function getAPI()
{
   // start by looking for the API in the current window
   var theAPI = findAPI(window);

   // if the API is null (could not be found in the current window)
   // and the current window has an opener window
   if ( (theAPI == null) &&
        (window.opener != null) &&
        (typeof(window.opener) != "undefined") )
   {
      // try to find the API in the current window’s opener
      theAPI = findAPI(window.opener);
   }
   
   return theAPI;
}
//Constants
var SCORM_TRUE = "true";
var SCORM_FALSE = "false";
var SCORM_NO_ERROR = "0";

//Since the Unload handler will be called twice, from both the onunload
//and onbeforeunload events, ensure that we only call LMSFinish once.
var finishCalled = false;

//Track whether or not we successfully initialized.
var initialized = false;

var API = null;
function ScormProcessInitialize(){
    var result;
    API = getAPI();
    if (API == null) {
      return;
    }
    result = API.LMSInitialize("");
    if (result == SCORM_FALSE){
        var errorNumber = API.LMSGetLastError();
        var errorString = API.LMSGetErrorString(errorNumber);
        var diagnostic = API.LMSGetDiagnostic(errorNumber);
        
        var errorDescription = "Number: " + errorNumber + "\nDescription: " + errorString + "\nDiagnostic: " + diagnostic;
        
        alert("Error - Could not initialize communication with the LMS.\n\nYour results may not be recorded.\n\n" + errorDescription);
        return;
    }
    API.LMSSetValue("cmi.core.score.min", 0);
    API.LMSSetValue("cmi.core.score.max", 100);
    initialized = true;
 }

function ScormProcessFinish(){
    
    var result;
    API.LMSSetValue("cmi.core.score.raw", yourScore.toFixed(2));
    API.LMSCommit();
    
    //Don't terminate if we haven't initialized or if we've already terminated
    if (initialized == false || finishCalled == true){return;}
    
    result = API.LMSFinish("");
    finishCalled = true;
    if (result == SCORM_FALSE){
        var errorNumber = API.LMSGetLastError();
        var errorString = API.LMSGetErrorString(errorNumber);
        var diagnostic = API.LMSGetDiagnostic(errorNumber);
        
        var errorDescription = "Number: " + errorNumber + "\nDescription: " + errorString + "\nDiagnostic: " + diagnostic;
        
        alert("Error - Could not terminate communication with the LMS.\n\nYour results may not be recorded.\n\n" + errorDescription);
        return;
    }
}

var verbPolite = [
"いきます", "かいます", "のみます", "かえります", "ききます", "たべます", "みます","おしえます", "きます", "します", "およぎます", "かします", "まちます", "います", "はしります", "うたいます", "とります", "はなします"
 ];
var verbDictionary = [
"いく", "かう", "のむ", "かえる", "きく", "たべる", "みる","おしえる", "くる", "する", "およぐ", "かす", "まつ", "いる", "はしる", "うたう", "とる", "はなす"
];


var currentAnswer = 0;


function generateQuestion(){
	setStat();
	return "<b>Q:</b> What is the dictionary form of <b>" + verbPolite[currentAnswer] + "</b>? Please type your answer.";
}
function setStat() {
        yourScore = ((totalTried>=20)?((totalCorrect/totalTried)*100):0);
	document.getElementById("currentStat").innerHTML = "<b>Total Answered:</b> " + totalTried + " <b>Total Correct</b>: " + totalCorrect 
		+ " <b>Score: </b>" + yourScore.toFixed(2) + "<br/><font color='blue'> (minimum of 20 tries is required to get a score)</font><br/><br/>";
}
function setNewQuestion() {
        var maxQuestions = verbDictionary.length;
        currentAnswer = Math.floor(maxQuestions*Math.random());
        document.getElementById("myQuestion").innerHTML = generateQuestion();
        document.getElementById("answer").innerHTML= "";
	document.getElementById("myTest").value = "";
	isScoreUpdated = false;
}
function correctAnswer(bool, yourAnswer){
if(!isScoreUpdated){
        totalTried++;
        document.getElementById("answer").innerHTML=(bool?("<font color='green'>Correct!</font> "+verbPolite[currentAnswer] + ":" + verbDictionary[currentAnswer]):("<font color='red'>Try again!</font> You wrote <font color='red'>" + yourAnswer + "</font>! Correct answer for <b>" + verbPolite[currentAnswer] + "</b> is " + verbDictionary[currentAnswer] + "."));
    	totalCorrect= bool?(totalCorrect+1):totalCorrect;
        isScoreUpdated = true;
   }
}

function checkAnswer(){
   var myObj = document.getElementById("myTest");
   var myAns = myObj.value;
//alert(myAns);
   if((myAns != undefined) && (myAns.trim() != "")){
   	correctAnswer(myAns.trim()==verbDictionary[currentAnswer], myAns.trim());
        //myObj.value = "";
   }
//alert(currentAnswer);
   //setNewQuestion();
}

function appendValue(obj){
    var CurrentBox = document.getElementById("myTest");
    var caretPos = CurrentBox.selectionStart;
    if((CurrentBox.value != null) && (caretPos != CurrentBox.value.length)) {    
        CurrentBox.value = CurrentBox.value.substring(0, caretPos) + obj.value + CurrentBox.value.substring(caretPos);
     }
   else {
       CurrentBox.value +=obj.value;
   }
}
function doStart() {
	
        ScormProcessInitialize();
	setNewQuestion();
}
function doUnload() {
	ScormProcessFinish();
}
</script>
</head>
<body style="text-align:center;" onload="doStart()"  onunload="doUnload();">
<table>
<tr>
<td class="topClass">
	   <table border="0">
		<tr>
		<td><h1>Dictionary Form Practice  <font size="5pt" color="green">(Lesson 15)</font></h1></td>
		</tr>
	    </table>
</td>
</tr>
<tr>
<td class="mStyle">
     <div id="currentStat"></div>
     <div class="mStyle">
	<div id="myQuestion"></div>
        <br/><br/>
        <form>
          Type directly below with Hiragana.<br/><br/>
          Your Answer: <input type="text" class="textfield" id="myTest" size="55"></input>
	<br/><br/>
        <div id="answer" style="font-family: 'UD Digi Kyokasho NK-R', sans-serif;"></div>
          <input type="button" value="NewQuestion" onclick="setNewQuestion()" ></input>
          <input type="button" value="Check Your Answer" onclick="checkAnswer()" ></input>
          
        </form>
     </div>
</td>

</tr>
<tr>
<td class="topClass">
Copyright &copy; m. nowzari
</td>
</tr>
</table>
</body>
</html>
